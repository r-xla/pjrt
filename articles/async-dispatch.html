<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Asynchronous Dispatch • pjrt</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Asynchronous Dispatch">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pjrt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/pjrt.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/async-dispatch.html">Asynchronous Dispatch</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-xla/pjrt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Asynchronous Dispatch</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-xla/pjrt/blob/feature/async-execution/vignettes/articles/async-dispatch.Rmd" class="external-link"><code>vignettes/articles/async-dispatch.Rmd</code></a></small>
      <div class="d-none name"><code>async-dispatch.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-problem-host-device-synchronization">The Problem: Host-Device Synchronization<a class="anchor" aria-label="anchor" href="#the-problem-host-device-synchronization"></a>
</h2>
<p>When running computations on accelerators (GPUs, TPUs, or even
optimized CPU backends), there’s a fundamental tension between the
<strong>host</strong> (R) and the <strong>device</strong> (accelerator).
By default, every operation follows a synchronous pattern:</p>
<ol style="list-style-type: decimal">
<li><p>R sends data to the device</p></li>
<li><p>R waits for the transfer to complete</p></li>
<li><p>R tells the device to execute a computation</p></li>
<li><p>R waits for the computation to complete</p></li>
<li><p>R retrieves the result</p></li>
<li><p>R waits for the transfer to complete</p></li>
</ol>
<p>This creates <strong>synchronization bubbles</strong>—periods where
either the host or the device sits idle waiting for the other. In a
training loop, these bubbles can significantly reduce throughput:</p>
<pre><code>Host:   [prepare batch] [wait...] [prepare batch] [wait...] [prepare batch]
Device:        [wait...] [compute]        [wait...] [compute]        [wait...]</code></pre>
<p>The ideal scenario overlaps host and device work:</p>
<pre><code>Host:   [prepare batch 1] [prepare batch 2] [prepare batch 3] [prepare batch 4]
Device:          [compute 1] [compute 2] [compute 3] [compute 4]</code></pre>
</div>
<div class="section level2">
<h2 id="asynchronous-dispatch-in-pjrt">Asynchronous Dispatch in pjrt<a class="anchor" aria-label="anchor" href="#asynchronous-dispatch-in-pjrt"></a>
</h2>
<p>The {pjrt} package provides async variants of key operations that
return immediately, allowing R to continue while the device works in the
background. These operations return <strong>promise</strong> objects
that can be awaited later.</p>
<div class="section level3">
<h3 id="the-async-api">The Async API<a class="anchor" aria-label="anchor" href="#the-async-api"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Sync Operation</th>
<th>Async Operation</th>
<th>Returns</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/pjrt_buffer.html">pjrt_buffer()</a></code></td>
<td><code><a href="../reference/pjrt_buffer_async.html">pjrt_buffer_async()</a></code></td>
<td><code>pjrt_buffer_promise</code></td>
</tr>
<tr class="even">
<td><code><a href="../reference/pjrt_execute.html">pjrt_execute()</a></code></td>
<td><code><a href="../reference/pjrt_execute_async.html">pjrt_execute_async()</a></code></td>
<td><code>pjrt_buffer_promise</code></td>
</tr>
<tr class="odd">
<td><code><a href="https://r-xla.github.io/tengen/reference/as_array.html" class="external-link">as_array()</a></code></td>
<td><code><a href="../reference/as_array_async.html">as_array_async()</a></code></td>
<td><code>pjrt_array_promise</code></td>
</tr>
</tbody>
</table>
<p>All async objects support:</p>
<ul>
<li>
<code>value(x)</code> - Block until ready and return the result</li>
<li>
<code>is_ready(x)</code> - Check if complete (non-blocking)</li>
<li>
<code>as_array(x)</code> - Convert to R array (blocks if
needed)</li>
</ul>
</div>
<div class="section level3">
<h3 id="basic-example">Basic Example<a class="anchor" aria-label="anchor" href="#basic-example"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-xla.github.io/pjrt/" class="external-link">pjrt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compile a simple program</span></span>
<span><span class="va">src</span> <span class="op">&lt;-</span> <span class="st">r"(</span></span>
<span><span class="st">func.func @main(%x: tensor&lt;1000x1000xf32&gt;) -&gt; tensor&lt;1000x1000xf32&gt; {</span></span>
<span><span class="st">  %0 = "stablehlo.add"(%x, %x) : (tensor&lt;1000x1000xf32&gt;, tensor&lt;1000x1000xf32&gt;) -&gt; tensor&lt;1000x1000xf32&gt;</span></span>
<span><span class="st">  "func.return"(%0): (tensor&lt;1000x1000xf32&gt;) -&gt; ()</span></span>
<span><span class="st">}</span></span>
<span><span class="st">)"</span></span>
<span><span class="va">executable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_compile.html">pjrt_compile</a></span><span class="op">(</span><span class="fu"><a href="../reference/pjrt_program.html">pjrt_program</a></span><span class="op">(</span><span class="va">src</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="synchronous-execution-blocking">Synchronous execution (blocking)<a class="anchor" aria-label="anchor" href="#synchronous-execution-blocking"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Each step blocks until complete</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">buf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_buffer.html">pjrt_buffer</a></span><span class="op">(</span><span class="va">data</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span>       <span class="co"># Blocks: wait for transfer</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_execute.html">pjrt_execute</a></span><span class="op">(</span><span class="va">executable</span>, <span class="va">buf</span><span class="op">)</span>        <span class="co"># Blocks: wait for computation</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-xla.github.io/tengen/reference/as_array.html" class="external-link">as_array</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>                     <span class="co"># Blocks: wait for transfer back</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="asynchronous-execution-non-blocking">Asynchronous execution (non-blocking)<a class="anchor" aria-label="anchor" href="#asynchronous-execution-non-blocking"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Operations return immediately</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">transfer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_buffer_async.html">pjrt_buffer_async</a></span><span class="op">(</span><span class="va">data</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span>  <span class="co"># Returns immediately</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_execute_async.html">pjrt_execute_async</a></span><span class="op">(</span><span class="va">executable</span>, <span class="va">transfer</span><span class="op">)</span>   <span class="co"># Returns immediately (auto-waits for transfer)</span></span>
<span><span class="va">async_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_array_async.html">as_array_async</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>               <span class="co"># Returns immediately</span></span>
<span></span>
<span><span class="co"># R can do other work here while device computes...</span></span>
<span></span>
<span><span class="co"># Only block when we actually need the value</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/value.html">value</a></span><span class="op">(</span><span class="va">async_output</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="smart-input-handling">Smart Input Handling<a class="anchor" aria-label="anchor" href="#smart-input-handling"></a>
</h2>
<p>A key feature of the async API is <strong>smart input
handling</strong>. PJRT manages dependencies internally, so you can
chain async operations without explicit waits:</p>
<ul>
<li>
<strong>Buffer promises</strong> (<code>pjrt_buffer_promise</code>):
The buffer is valid immediately - PJRT handles dependencies internally.
R returns immediately without blocking.</li>
<li>Buffer promises can be passed to <code><a href="../reference/as_array_async.html">as_array_async()</a></code> or
used as inputs to other executions - PJRT handles the dependency.</li>
</ul>
<p>This enables true pipelining where transfers and execution
overlap:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start two async transfers in parallel</span></span>
<span><span class="va">buf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_buffer_async.html">pjrt_buffer_async</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span></span>
<span><span class="va">buf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_buffer_async.html">pjrt_buffer_async</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Execute with async inputs - auto-waits internally</span></span>
<span><span class="va">src2</span> <span class="op">&lt;-</span> <span class="st">r"(</span></span>
<span><span class="st">func.func @main(%x: tensor&lt;2x2xf32&gt;, %y: tensor&lt;2x2xf32&gt;) -&gt; tensor&lt;2x2xf32&gt; {</span></span>
<span><span class="st">  %0 = "stablehlo.add"(%x, %y) : (tensor&lt;2x2xf32&gt;, tensor&lt;2x2xf32&gt;) -&gt; tensor&lt;2x2xf32&gt;</span></span>
<span><span class="st">  "func.return"(%0): (tensor&lt;2x2xf32&gt;) -&gt; ()</span></span>
<span><span class="st">}</span></span>
<span><span class="st">)"</span></span>
<span><span class="va">exec2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_compile.html">pjrt_compile</a></span><span class="op">(</span><span class="fu"><a href="../reference/pjrt_program.html">pjrt_program</a></span><span class="op">(</span><span class="va">src2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Pass async transfers directly - no explicit value() needed</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_execute_async.html">pjrt_execute_async</a></span><span class="op">(</span><span class="va">exec2</span>, <span class="va">buf1</span>, <span class="va">buf2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-xla.github.io/tengen/reference/as_array.html" class="external-link">as_array</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    6   10</span></span>
<span><span class="co">#&gt; [2,]    8   12</span></span></code></pre></div>
<div class="section level3">
<h3 id="chaining-execution-with-device-to-host-transfer">Chaining Execution with Device-to-Host Transfer<a class="anchor" aria-label="anchor" href="#chaining-execution-with-device-to-host-transfer"></a>
</h3>
<p>You can also chain async execution with async device-to-host transfer
without blocking:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start async execution</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_execute_async.html">pjrt_execute_async</a></span><span class="op">(</span><span class="va">executable</span>, <span class="fu"><a href="../reference/pjrt_buffer.html">pjrt_buffer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1e6</span><span class="op">)</span>, <span class="fl">1000</span>, <span class="fl">1000</span><span class="op">)</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Chain with async device-to-host transfer - returns immediately!</span></span>
<span><span class="co"># PJRT internally waits for execution to complete before starting transfer</span></span>
<span><span class="va">async_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_array_async.html">as_array_async</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># R can do other work here...</span></span>
<span></span>
<span><span class="co"># Only block when we need the final R array</span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/value.html">value</a></span><span class="op">(</span><span class="va">async_output</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="when-blocking-happens">When Blocking Happens<a class="anchor" aria-label="anchor" href="#when-blocking-happens"></a>
</h2>
<p>Understanding when R blocks is crucial for writing efficient code.
Blocking occurs when:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Calling <code><a href="../reference/value.html">value()</a></code></strong> - Explicitly waiting
for an async operation</li>
<li>
<strong>Calling <code><a href="https://r-xla.github.io/tengen/reference/as_array.html" class="external-link">as_array()</a></code> on a buffer</strong> -
Transfers data from device to host</li>
<li>
<strong>Printing a buffer</strong> - Needs to read values to display
them</li>
<li><strong>Any operation that needs the actual data</strong></li>
</ol>
<div class="section level3">
<h3 id="avoid-unnecessary-blocking">Avoid Unnecessary Blocking<a class="anchor" aria-label="anchor" href="#avoid-unnecessary-blocking"></a>
</h3>
<p><strong>Bad pattern</strong> - Blocking in every iteration:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_iterations</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_execute.html">pjrt_execute</a></span><span class="op">(</span><span class="va">executable</span>, <span class="va">input</span><span class="op">)</span></span>
<span>  <span class="va">metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-xla.github.io/tengen/reference/as_array.html" class="external-link">as_array</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span>  <span class="co"># BLOCKS! Device waits while we transfer</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Step"</span>, <span class="va">i</span>, <span class="st">"loss:"</span>, <span class="va">metrics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">input</span> <span class="op">&lt;-</span> <span class="fu">prepare_next_batch</span><span class="op">(</span><span class="op">)</span>  <span class="co"># Device idle during data prep</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Better pattern</strong> - Log previous iteration’s
metrics:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prev_result</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_iterations</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Start this iteration's computation</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_execute_async.html">pjrt_execute_async</a></span><span class="op">(</span><span class="va">executable</span>, <span class="va">input</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># While device computes, log PREVIOUS iteration's metrics</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">prev_result</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-xla.github.io/tengen/reference/as_array.html" class="external-link">as_array</a></span><span class="op">(</span><span class="va">prev_result</span><span class="op">)</span>  <span class="co"># Previous result likely ready</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Step"</span>, <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"loss:"</span>, <span class="va">metrics</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># Prepare next batch while device still computing</span></span>
<span>  <span class="va">input</span> <span class="op">&lt;-</span> <span class="fu">prepare_next_batch</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">prev_result</span> <span class="op">&lt;-</span> <span class="va">result</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="checking-readiness">Checking Readiness<a class="anchor" aria-label="anchor" href="#checking-readiness"></a>
</h2>
<p>Use <code><a href="../reference/is_ready.html">is_ready()</a></code> for non-blocking status checks:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start async operation</span></span>
<span><span class="va">transfer</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_buffer_async.html">pjrt_buffer_async</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1e6</span><span class="op">)</span>, <span class="fl">1000</span>, <span class="fl">1000</span><span class="op">)</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check without blocking</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/is_ready.html">is_ready</a></span><span class="op">(</span><span class="va">transfer</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Transfer complete!"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Still transferring..."</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Transfer complete!</span></span>
<span></span>
<span><span class="co"># Eventually get the value (blocks if needed)</span></span>
<span><span class="va">buf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/value.html">value</a></span><span class="op">(</span><span class="va">transfer</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="full-async-pipeline-example">Full Async Pipeline Example<a class="anchor" aria-label="anchor" href="#full-async-pipeline-example"></a>
</h2>
<p>Here’s a complete example showing the full async pipeline:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-xla.github.io/pjrt/" class="external-link">pjrt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simple multiply-add program</span></span>
<span><span class="va">src</span> <span class="op">&lt;-</span> <span class="st">r"(</span></span>
<span><span class="st">func.func @main(%x: tensor&lt;100x100xf32&gt;, %y: tensor&lt;100x100xf32&gt;) -&gt; tensor&lt;100x100xf32&gt; {</span></span>
<span><span class="st">  %0 = "stablehlo.multiply"(%x, %y) : (tensor&lt;100x100xf32&gt;, tensor&lt;100x100xf32&gt;) -&gt; tensor&lt;100x100xf32&gt;</span></span>
<span><span class="st">  %1 = "stablehlo.add"(%0, %x) : (tensor&lt;100x100xf32&gt;, tensor&lt;100x100xf32&gt;) -&gt; tensor&lt;100x100xf32&gt;</span></span>
<span><span class="st">  "func.return"(%1): (tensor&lt;100x100xf32&gt;) -&gt; ()</span></span>
<span><span class="st">}</span></span>
<span><span class="st">)"</span></span>
<span><span class="va">executable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_compile.html">pjrt_compile</a></span><span class="op">(</span><span class="fu"><a href="../reference/pjrt_program.html">pjrt_program</a></span><span class="op">(</span><span class="va">src</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate a mini training loop</span></span>
<span><span class="va">n_steps</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100L</span>, <span class="fl">100L</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize with async transfer</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_buffer_async.html">pjrt_buffer_async</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">shape</span><span class="op">)</span><span class="op">)</span>, <span class="va">shape</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">shape</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_buffer_async.html">pjrt_buffer_async</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="va">shape</span><span class="op">)</span><span class="op">)</span>, <span class="va">shape</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">shape</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">step</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_steps</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Execute asynchronously (auto-waits for x and y if needed)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_execute_async.html">pjrt_execute_async</a></span><span class="op">(</span><span class="va">executable</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Use result as input to next iteration (chaining)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">result</span></span>
<span></span>
<span>  <span class="co"># Only on last iteration, get the actual value</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">step</span> <span class="op">==</span> <span class="va">n_steps</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-xla.github.io/tengen/reference/as_array.html" class="external-link">as_array</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Final result shape:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">final</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Final result[1,1]:"</span>, <span class="va">final</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Final result shape: 100 100 </span></span>
<span><span class="co">#&gt; Final result[1,1]: 4.000973</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="benchmark-sync-vs-async">Benchmark: Sync vs Async<a class="anchor" aria-label="anchor" href="#benchmark-sync-vs-async"></a>
</h2>
<p>Let’s compare synchronous and asynchronous execution patterns. We’ll
simulate a training loop where each iteration involves preparing input
data (simulated with <code><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep()</a></code> to represent loading from
disk or preprocessing).</p>
<p><strong>Note:</strong> On the CPU backend used in this vignette, the
async benefit is minimal because execution is very fast and happens on
the same CPU as R. The real benefit appears on GPU/TPU backends
where:</p>
<ul>
<li>Device computation takes significant time (hundreds of
milliseconds)</li>
<li>The device operates independently from the host CPU</li>
<li>True parallelism is possible between host data preparation and
device execution</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-xla.github.io/pjrt/" class="external-link">pjrt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compile a matrix multiply program</span></span>
<span><span class="va">src</span> <span class="op">&lt;-</span> <span class="st">r"(</span></span>
<span><span class="st">func.func @main(%x: tensor&lt;1000x1000xf32&gt;) -&gt; tensor&lt;1000x1000xf32&gt; {</span></span>
<span><span class="st">  %0 = "stablehlo.dot"(%x, %x) : (tensor&lt;1000x1000xf32&gt;, tensor&lt;1000x1000xf32&gt;) -&gt; tensor&lt;1000x1000xf32&gt;</span></span>
<span><span class="st">  "func.return"(%0): (tensor&lt;1000x1000xf32&gt;) -&gt; ()</span></span>
<span><span class="st">}</span></span>
<span><span class="st">)"</span></span>
<span><span class="va">executable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_compile.html">pjrt_compile</a></span><span class="op">(</span><span class="fu"><a href="../reference/pjrt_program.html">pjrt_program</a></span><span class="op">(</span><span class="va">src</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_iterations</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">data_prep_time</span> <span class="op">&lt;-</span> <span class="fl">0.02</span>  <span class="co"># Simulate 20ms data preparation</span></span>
<span></span>
<span><span class="va">prepare_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html" class="external-link">Sys.sleep</a></span><span class="op">(</span><span class="va">data_prep_time</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1000</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span>, <span class="fl">1000</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level3">
<h3 id="synchronous-pattern">Synchronous Pattern<a class="anchor" aria-label="anchor" href="#synchronous-pattern"></a>
</h3>
<p>Each operation blocks before the next can start:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sync_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_iterations</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">prepare_data</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">buf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_buffer.html">pjrt_buffer</a></span><span class="op">(</span><span class="va">data</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_execute.html">pjrt_execute</a></span><span class="op">(</span><span class="va">executable</span>, <span class="va">buf</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-xla.github.io/tengen/reference/as_array.html" class="external-link">as_array</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Synchronous total time:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sync_time</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"seconds\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Synchronous total time: 0.242 seconds</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="asynchronous-pattern">Asynchronous Pattern<a class="anchor" aria-label="anchor" href="#asynchronous-pattern"></a>
</h3>
<p>R prepares the next batch while the device computes:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">async_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">prepare_data</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">buf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_buffer_async.html">pjrt_buffer_async</a></span><span class="op">(</span><span class="va">data</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_execute_async.html">pjrt_execute_async</a></span><span class="op">(</span><span class="va">executable</span>, <span class="va">buf</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_iterations</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">prepare_data</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">buf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_buffer_async.html">pjrt_buffer_async</a></span><span class="op">(</span><span class="va">data</span>, dtype <span class="op">=</span> <span class="st">"f32"</span><span class="op">)</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pjrt_execute_async.html">pjrt_execute_async</a></span><span class="op">(</span><span class="va">executable</span>, <span class="va">buf</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-xla.github.io/tengen/reference/as_array.html" class="external-link">as_array</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Asynchronous total time:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">async_time</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"seconds\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Asynchronous total time: 0.197 seconds</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Sync:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">sync_time</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"s, Async:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">async_time</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"s\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sync: 0.242 s, Async: 0.197 s</span></span></code></pre></div>
<p>On CPU, both patterns have similar performance because:</p>
<ul>
<li>CPU execution is very fast (a few milliseconds)</li>
<li>The same CPU handles both R code and PJRT execution</li>
<li>Little opportunity for true parallelism</li>
</ul>
<p>On <strong>GPU/TPU backends</strong>, the async pattern shines
because:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Data preparation overlaps with execution</strong>: While the
GPU runs iteration N, R prepares data for N+1</li>
<li>
<strong>Transfers overlap with execution</strong>: Host-to-device
transfers happen while previous computations run</li>
<li>
<strong>No idle time</strong>: The device stays busy instead of
waiting for R</li>
</ol>
<p>In production GPU training loops, async dispatch can provide
<strong>1.2-2x speedup</strong> depending on the ratio of data
preparation time to computation time.</p>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<table class="table">
<colgroup>
<col width="40%">
<col width="59%">
</colgroup>
<thead><tr class="header">
<th>Pattern</th>
<th>When to Use</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/pjrt_buffer.html">pjrt_buffer()</a></code></td>
<td>Simple scripts, when you need the buffer immediately</td>
</tr>
<tr class="even">
<td><code><a href="../reference/pjrt_buffer_async.html">pjrt_buffer_async()</a></code></td>
<td>Training loops, when overlapping transfers with computation</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/pjrt_execute.html">pjrt_execute()</a></code></td>
<td>Simple inference, when you need results immediately</td>
</tr>
<tr class="even">
<td><code><a href="../reference/pjrt_execute_async.html">pjrt_execute_async()</a></code></td>
<td>Training loops, pipelining multiple operations</td>
</tr>
<tr class="odd">
<td><code><a href="https://r-xla.github.io/tengen/reference/as_array.html" class="external-link">as_array()</a></code></td>
<td>When you need R values now</td>
</tr>
<tr class="even">
<td><code><a href="../reference/as_array_async.html">as_array_async()</a></code></td>
<td>When you want to overlap device-to-host transfer</td>
</tr>
</tbody>
</table>
<p>The key insight is that <strong>blocking should happen as late as
possible</strong>. By using async operations and delaying
<code><a href="../reference/value.html">value()</a></code> calls, you allow the device to stay busy while R
prepares the next batch of work.</p>
</div>
<div class="section level2">
<h2 id="further-reading">Further Reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<p>The concepts in this vignette are inspired by JAX’s approach to
asynchronous dispatch:</p>
<ul>
<li><a href="https://docs.jax.dev/en/latest/async_dispatch.html" class="external-link">Asynchronous
dispatch in JAX</a></li>
<li><a href="https://docs.jax.dev/en/latest/the-training-cookbook.html#efficiency-via-asynchronous-dispatch" class="external-link">The
Training Cookbook: Efficiency via Asynchronous Dispatch</a></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Fischer, Daniel Falbel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
